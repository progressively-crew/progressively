// When resolving an experiment in client side,
// it should be like "flag.experimentKey = "variantKey"
model Experiment {
    uuid                  String                  @id @default(uuid())
    name                  String
    key                   String
    description           String
    createdAt             DateTime                @default(now())
    ExperimentEnvironment ExperimentEnvironment[]
    variants              Variant[]
}

model Variant {
    uuid           String   @id @default(uuid())
    key            String
    name           String
    description    String
    createdAt      DateTime @default(now())
    experimentUuid String?
    isControl      Boolean  @default(false)

    Experiment Experiment?  @relation(fields: [experimentUuid], references: [uuid], onDelete: Cascade)
    VariantHit VariantHit[]
}

model VariantHit {
    id          Int      @id @default(autoincrement())
    date        DateTime @default(now())
    variant     Variant  @relation(fields: [variantUuid], references: [uuid], onDelete: Cascade)
    variantUuid String
}

model ExperimentEnvironment {
    experiment    Experiment  @relation(fields: [experimentId], references: [uuid], onDelete: Cascade)
    experimentId  String
    environment   Environment @relation(fields: [environmentId], references: [uuid])
    environmentId String
    // the values set in ab/experiment.status.ts
    status        String      @default("NOT_ACTIVATED")

    @@id([experimentId, environmentId])
}

// Alias model, don't touch this one.
// If you need to modify the EnvironmentModel, go into the base.prisma file
model Environment {
    uuid                  String                  @id @default(uuid())
    ExperimentEnvironment ExperimentEnvironment[]
}
