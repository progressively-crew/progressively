---
import GetStartedCTA from "../components/GetStartedCTA.astro";
import LinkButton from "../components/LinkButton.astro";
import { PullTriggerSection } from "../components/PullTriggerSection";
import { SpeedUpDevelopment } from "../components/SpeedUpDevelopment";
import Layout from "../layouts/Layout.astro";
import hljs from "highlight.js";
import Logo from "../components/Logo.astro";
import { FeedbackLoop } from "../components/FeedbackLoop";
import { InstallationStep } from "../components/InstallationStep";
import { PricingSection } from "../components/PricingSection";

const frontendUrl = import.meta.env.FRONTEND_URL;

const trialUrl = `${frontendUrl}/register`;

const clientComponent = hljs.highlight(
  `
import { useFlags } from "@progressively/react";

const FlaggedComponent = () => {
  const { flags } = useFlags();

  if (flags.newFlag) {
    return <div>New variant</div>;
  }

  return <div>Old variant</div>;
};

// It's as simple as that.

`,
  { language: "jsx" }
).value;

const abcVersions = hljs.highlight(
  `
import { useFlags } from "@progressively/react";

const FlaggedComponent = () => {
  const { flags } = useFlags();

  if (flags.newFlag === "B") {
    return <VersionB />;
  }

  if (flags.newFlag === "C") {
    return <VersionC />;
  }

  return <VersionA />;
};

`,
  { language: "jsx" }
).value;

const smallSnippet = hljs.highlight(
  `
const { flags } = useFlags();     

if (flags.newFeature) {
  return <NewFeature />;
}

return <OldFeature />;

`,
  { language: "jsx" }
).value;
---

<Layout title="Welcome to Progressively, the new feature flag solution.">
  <div class="bg-gradient-to-b from-slate-900 via-slate-800 to-fuchsia-900">
    <header
      class="py-12 md:py-32 gap-8 px-12 max-w-screen-2xl mx-auto items-center"
    >
      <div class="flex justify-center flex-col items-center">
        <Logo width={60} height={60} />
        <h1
          class="text-center text-4xl md:text-5xl font-extrabold text-white pt-4 !leading-tight animate-fade-enter-top"
        >
          Stress-less & risk-free<br />feature deployments
        </h1>

        <p
          class="text-center md:text-left text-xl md:text-2xl text-white pt-4 leading-relaxed animate-fade-enter-bottom opacity-0"
          style={{ animationDelay: "300ms" }}
        >
          Deploy your features confidently, without stress, and <strong
            >progressively</strong
          >.
        </p>

        <div
          class="flex flex-col sm:flex-row gap-4 pt-8 animate-fade-enter-bottom opacity-0"
          style={{ animationDelay: "500ms" }}
        >
          <LinkButton
            variant="primary-inverse"
            href="https://dashboard.progressively.app/signin"
            target={"_blank"}
            id="get-started"
          >
            Get started
          </LinkButton>

          <LinkButton
            href="https://docs.progressively.app/"
            target={"_blank"}
            variant="secondary-inverse"
            id="documentation-btn"
          >
            Documentation
          </LinkButton>
        </div>
      </div>

      <div class="hidden md:block pt-20">
        <PullTriggerSection client:load clientComponent={clientComponent} />
      </div>
    </header>
  </div>

  <main>
    <SpeedUpDevelopment client:load />

    <FeedbackLoop client:load abcVersions={abcVersions} />

    <InstallationStep client:load code={smallSnippet} />

    <PricingSection client:load trialUrl={trialUrl} />

    <GetStartedCTA />
  </main>
</Layout>

<script>
  import { Progressively } from "@progressively/sdk-js";

  const sdk = Progressively.init("f2432529-0da2-4702-850e-b96d70267308");
  const getStarted = document.querySelector("#get-started");
  const documentation = document.querySelector("#documentation-btn");

  await sdk.loadFlags(); // make sure to it the endpoint

  getStarted?.addEventListener("click", function () {
    sdk.track("Hit get started");
  });

  documentation?.addEventListener("click", function () {
    sdk.track("Hit documentation");
  });
</script>
