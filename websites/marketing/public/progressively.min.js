!function(){"use strict";let e,t,n;function r(r,i){if(n=new Date,r.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===r.tagName.toLowerCase())return"html";const l={root:document.body,idName:e=>!0,className:e=>!0,tagName:e=>!0,attr:(e,t)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};e=Object.assign(Object.assign({},l),i),t=function(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return e;if(e===t.root)return e.ownerDocument;return e}(e.root,l);let s=o(r,"all",(()=>o(r,"two",(()=>o(r,"one",(()=>o(r,"none")))))));if(s){const e=w(b(s,r));return e.length>0&&(s=e[0]),a(s)}throw new Error("Selector was not found.")}function o(t,r,o){let a=null,l=[],s=t,y=0;for(;s;){const t=(new Date).getTime()-n.getTime();if(void 0!==e.timeoutMs&&t>e.timeoutMs)throw new Error(`Timeout: Can't find a unique selector after ${t}ms`);let v=g(u(s))||g(...c(s))||g(...d(s))||g(f(s))||[{name:"*",penalty:3}];const w=p(s);if("all"==r)w&&(v=v.concat(v.filter(m).map((e=>h(e,w)))));else if("two"==r)v=v.slice(0,1),w&&(v=v.concat(v.filter(m).map((e=>h(e,w)))));else if("one"==r){const[e]=v=v.slice(0,1);w&&m(e)&&(v=[h(e,w)])}else"none"==r&&(v=[{name:"*",penalty:3}],w&&(v=[h(v[0],w)]));for(let e of v)e.level=y;if(l.push(v),l.length>=e.seedMinLength&&(a=i(l,o),a))break;s=s.parentElement,y++}return a||(a=i(l,o)),!a&&o?o():a}function i(t,n){const r=w(v(t));if(r.length>e.threshold)return n?n():null;for(let e of r)if(s(e))return e;return null}function a(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){const o=e[r].level||0;n=t.level===o-1?`${e[r].name} > ${n}`:`${e[r].name} ${n}`,t=e[r]}return n}function l(e){return e.map((e=>e.penalty)).reduce(((e,t)=>e+t),0)}function s(e){const n=a(e);switch(t.querySelectorAll(n).length){case 0:throw new Error(`Can't select any node with this selector: ${n}`);case 1:return!0;default:return!1}}function u(t){const n=t.getAttribute("id");return n&&e.idName(n)?{name:"#"+CSS.escape(n),penalty:0}:null}function c(t){const n=Array.from(t.attributes).filter((t=>e.attr(t.name,t.value)));return n.map((e=>({name:`[${CSS.escape(e.name)}="${CSS.escape(e.value)}"]`,penalty:.5})))}function d(t){return Array.from(t.classList).filter(e.className).map((e=>({name:"."+CSS.escape(e),penalty:1})))}function f(t){const n=t.tagName.toLowerCase();return e.tagName(n)?{name:n,penalty:2}:null}function p(e){const t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function h(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function m(e){return"html"!==e.name&&!e.name.startsWith("#")}function g(...e){const t=e.filter(y);return t.length>0?t:null}function y(e){return null!=e}function*v(e,t=[]){if(e.length>0)for(let n of e[0])yield*v(e.slice(1,e.length),t.concat(n));else yield t}function w(e){return[...e].sort(((e,t)=>l(e)-l(t)))}function*b(t,n,r={counter:0,visited:new Map}){if(t.length>2&&t.length>e.optimizedMinLength)for(let o=1;o<t.length-1;o++){if(r.counter>e.maxNumberOfTries)return;r.counter+=1;const i=[...t];i.splice(o,1);const l=a(i);if(r.visited.has(l))return;s(i)&&N(i,n)&&(yield i,r.visited.set(l,!0),yield*b(i,n,r))}}function N(e,n){return t.querySelector(a(e))===n}const{endpoint:S,bSixtyFour:E,shouldTrackQuantitative:T}=(()=>{const e=window.document.currentScript,t=null==e?void 0:e.getAttribute("data-progressively-endpoint"),n=null==e?void 0:e.getAttribute("data-progressively-client-key"),r=null==e?void 0:e.getAttribute("data-progressively-qualitative-tracking");if(!t||!n)throw new Error("[Progressively]: [data-progressively-endpoint] and [data-progressively-client-key] attributes should be set on the script tag.");const o={clientKey:n};return{endpoint:t,bSixtyFour:btoa(JSON.stringify(o)),shouldTrackQuantitative:r}})();let C=[];const O=()=>{const e=C.map((e=>{var t,n,r,o;return{name:e.name,url:window.location.href,referer:window.document.referrer||void 0,viewportWidth:window.innerWidth,viewportHeight:document.documentElement.scrollHeight,posX:null===(t=e.opts)||void 0===t?void 0:t.posX,posY:null===(n=e.opts)||void 0===n?void 0:n.posY,selector:null===(r=e.opts)||void 0===r?void 0:r.selector,data:(null===(o=e.opts)||void 0===o?void 0:o.data)?"string"==typeof e.opts.data?e.opts.data:JSON.stringify(e.opts.data):void 0}}));return C=[],fetch(`${S}/sdk/${E}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})};setInterval((()=>{C.length>0&&O()}),5e3);const x=(e,t={})=>{C.push({name:e,opts:t}),C.length>=10&&O()},L=()=>x("Page View");(e=>{window.addEventListener("popstate",e);const t=history.pushState,n=history.replaceState;history.pushState=function(...n){t.apply(this,n),e()},history.replaceState=function(...t){n.apply(this,t),e()}})(L),T&&(e=>{document.addEventListener("click",(t=>{if(!t.target)return;const n=t.target;if(!(e=>{if(-1!==["A","BUTTON","INPUT","SELECT","TEXTAREA"].indexOf(e.tagName))return!0;if(e.isContentEditable)return!0;if(e.hasAttribute("tabindex")&&e.tabIndex>=0)return!0;const t=e.getAttribute("role");return!(!t||-1===["button","checkbox","link","menuitem","option","radio","searchbox","slider","spinbutton","switch","textbox"].indexOf(t.toLowerCase()))})(n))return;const o=r(n,{seedMinLength:4});e("__click",{posX:t.pageX,posY:t.pageY,selector:o})}))})(x),-1!==window.location.href.indexOf("#__progressively")&&(e=>{const t=document.createElement("script");t.src="http://localhost:4321/progressively.qualitative-analytics.min.js",t.setAttribute("data-progressively-endpoint",e),document.body.appendChild(t)})(S),L(),window.track=x}();
