!function(){"use strict";const t=t=>{window.addEventListener("popstate",t);const e=history.pushState,n=history.replaceState;history.pushState=function(...n){e.apply(this,n),t()},history.replaceState=function(...e){n.apply(this,e),t()}};let e,n,r;function o(t,o){if(r=new Date,t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===t.tagName.toLowerCase())return"html";const a={root:document.body,idName:t=>!0,className:t=>!0,tagName:t=>!0,attr:(t,e)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};e=Object.assign(Object.assign({},a),o),n=function(t,e){if(t.nodeType===Node.DOCUMENT_NODE)return t;if(t===e.root)return t.ownerDocument;return t}(e.root,a);let s=i(t,"all",(()=>i(t,"two",(()=>i(t,"one",(()=>i(t,"none")))))));if(s){const e=b(N(s,t));return e.length>0&&(s=e[0]),l(s)}throw new Error("Selector was not found.")}function i(t,n,o){let i=null,l=[],s=t,u=0;for(;s;){const t=(new Date).getTime()-r.getTime();if(void 0!==e.timeoutMs&&t>e.timeoutMs)throw new Error(`Timeout: Can't find a unique selector after ${t}ms`);let v=y(c(s))||y(...d(s))||y(...f(s))||y(p(s))||[{name:"*",penalty:3}];const w=m(s);if("all"==n)w&&(v=v.concat(v.filter(g).map((t=>h(t,w)))));else if("two"==n)v=v.slice(0,1),w&&(v=v.concat(v.filter(g).map((t=>h(t,w)))));else if("one"==n){const[t]=v=v.slice(0,1);w&&g(t)&&(v=[h(t,w)])}else"none"==n&&(v=[{name:"*",penalty:3}],w&&(v=[h(v[0],w)]));for(let t of v)t.level=u;if(l.push(v),l.length>=e.seedMinLength&&(i=a(l,o),i))break;s=s.parentElement,u++}return i||(i=a(l,o)),!i&&o?o():i}function a(t,n){const r=b(w(t));if(r.length>e.threshold)return n?n():null;for(let t of r)if(u(t))return t;return null}function l(t){let e=t[0],n=e.name;for(let r=1;r<t.length;r++){const o=t[r].level||0;n=e.level===o-1?`${t[r].name} > ${n}`:`${t[r].name} ${n}`,e=t[r]}return n}function s(t){return t.map((t=>t.penalty)).reduce(((t,e)=>t+e),0)}function u(t){const e=l(t);switch(n.querySelectorAll(e).length){case 0:throw new Error(`Can't select any node with this selector: ${e}`);case 1:return!0;default:return!1}}function c(t){const n=t.getAttribute("id");return n&&e.idName(n)?{name:"#"+CSS.escape(n),penalty:0}:null}function d(t){const n=Array.from(t.attributes).filter((t=>e.attr(t.name,t.value)));return n.map((t=>({name:`[${CSS.escape(t.name)}="${CSS.escape(t.value)}"]`,penalty:.5})))}function f(t){return Array.from(t.classList).filter(e.className).map((t=>({name:"."+CSS.escape(t),penalty:1})))}function p(t){const n=t.tagName.toLowerCase();return e.tagName(n)?{name:n,penalty:2}:null}function m(t){const e=t.parentNode;if(!e)return null;let n=e.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==t);)n=n.nextSibling;return r}function h(t,e){return{name:t.name+`:nth-child(${e})`,penalty:t.penalty+1}}function g(t){return"html"!==t.name&&!t.name.startsWith("#")}function y(...t){const e=t.filter(v);return e.length>0?e:null}function v(t){return null!=t}function*w(t,e=[]){if(t.length>0)for(let n of t[0])yield*w(t.slice(1,t.length),e.concat(n));else yield e}function b(t){return[...t].sort(((t,e)=>s(t)-s(e)))}function*N(t,n,r={counter:0,visited:new Map}){if(t.length>2&&t.length>e.optimizedMinLength)for(let o=1;o<t.length-1;o++){if(r.counter>e.maxNumberOfTries)return;r.counter+=1;const i=[...t];i.splice(o,1);const a=l(i);if(r.visited.has(a))return;u(i)&&E(i,n)&&(yield i,r.visited.set(a,!0),yield*N(i,n,r))}}function E(t,e){return n.querySelector(l(t))===e}const S="data-analytics-click",{endpoint:T,bSixtyFour:A,shouldTrackQuantitative:C}=(()=>{const t=window.document.currentScript,e=null==t?void 0:t.getAttribute("data-progressively-endpoint"),n=null==t?void 0:t.getAttribute("data-progressively-client-key"),r=null==t?void 0:t.getAttribute("data-progressively-qualitative-tracking");if(!e||!n)throw new Error("[Progressively]: [data-progressively-endpoint] and [data-progressively-client-key] attributes should be set on the script tag.");const o={clientKey:n};return{endpoint:e,bSixtyFour:btoa(JSON.stringify(o)),shouldTrackQuantitative:r}})(),k=-1!==window.location.href.indexOf("#__progressively");let O=[];const x=()=>{const t=O.map((t=>{var e,n,r,o;return{name:t.name,url:window.location.href,referer:window.document.referrer||void 0,viewportWidth:window.innerWidth,viewportHeight:document.documentElement.scrollHeight,posX:null===(e=t.opts)||void 0===e?void 0:e.posX,posY:null===(n=t.opts)||void 0===n?void 0:n.posY,selector:null===(r=t.opts)||void 0===r?void 0:r.selector,data:(null===(o=t.opts)||void 0===o?void 0:o.data)?"string"==typeof t.opts.data?t.opts.data:JSON.stringify(t.opts.data):void 0}}));return O=[],fetch(`${T}/sdk/${A}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))};setInterval((()=>{O.length>0&&x()}),5e3);const L=(t,e={})=>(O.push({name:t,opts:e}),O.length>=10&&x(),Promise.resolve(void 0)),M=()=>L("Page View");k?(t=>{const e=document.createElement("script");e.src="https://progressively.app/progressively.qualitative-analytics.min.js",e.setAttribute("data-progressively-endpoint",t),document.body.appendChild(e)})(T):(t(M),M(),C&&((t,e)=>{document.addEventListener("click",(n=>{if(!n.target)return;const r=n.target;if(r.getAttribute(S))return;if(!(t=>{if(-1!==["A","BUTTON","INPUT","SELECT","TEXTAREA"].indexOf(t.tagName))return!0;if(t.isContentEditable)return!0;if(t.hasAttribute("tabindex")&&t.tabIndex>=0)return!0;const e=t.getAttribute("role");return!(!e||-1===["button","checkbox","link","menuitem","option","radio","searchbox","slider","spinbutton","switch","textbox"].indexOf(e.toLowerCase()))})(r))return;const i=o(r,{seedMinLength:4});if(t("__click",{posX:n.pageX,posY:n.pageY,selector:i}),"A"===r.tagName&&r.getAttribute("href")&&"_blank"!==r.getAttribute("target")){n.preventDefault();const t=n.ctrlKey||n.metaKey,o=document.createElement("a");return t&&(o.target="_blank"),o.href=r.getAttribute("href"),o.setAttribute(S,"true"),e().then((()=>{o.click()}))}}))})(L,x)),window.track=L}();
